import{c as q,d as F,q as I,aw as rt,C as lt,b as D,i as ut,x as Y,G as dt,v as j,a as m,aq as ht,A as pt,n as U,l as ft,ax as vt,V as P,Q as E,an as _t,aC as mt,aJ as J,p as gt,s as xt,t as yt,e as kt,ae as Ct,af as St,w as K,_ as Q,X as Z,$ as v,a0 as C,au as W,a1 as L,a4 as A,a5 as R,a2 as Tt,aa as V,a3 as N,Y as bt,al as wt,am as At}from"./index.b5f2d632.js";import{T as It,a as $t}from"./index.98e83128.js";import"./index.9387c4e7.js";import{C as Rt,S as Dt}from"./index.898efe2e.js";import{u as tt}from"./city.c8a35f2d.js";import{u as Ot,a as et}from"./index.7dad203a.js";import"./use-id.1fe87d75.js";import"./use-refs.d01481f9.js";function Bt(){const t="A".charCodeAt(0);return Array(26).fill("").map((o,u)=>String.fromCharCode(t+u))}const[ot,B]=q("index-bar"),Pt={sticky:pt,zIndex:U,teleport:[String,Object],highlightColor:String,stickyOffsetTop:ft(0),indexList:{type:Array,default:Bt}},nt=Symbol(ot);var Et=F({name:ot,props:Pt,emits:["select","change"],setup(t,{emit:g,slots:o}){const u=I(),r=I(),d=I(""),a=Ot(),h=rt(u),{children:n,linkChildren:x}=lt(nt);let c;x({props:t});const y=D(()=>{if(ut(t.zIndex))return{zIndex:+t.zIndex+1}}),p=D(()=>{if(t.highlightColor)return{color:t.highlightColor}}),_=(e,s)=>{for(let i=n.length-1;i>=0;i--){const f=i>0?s[i-1].height:0,l=t.sticky?f+t.stickyOffsetTop:0;if(e+l>=s[i].top)return i}return-1},b=e=>n.find(s=>String(s.index)===e),O=()=>{if(vt(u))return;const{sticky:e,indexList:s}=t,i=P(h.value),f=E(h),l=n.map(w=>w.getRect(h.value,f));let S=-1;if(c){const w=b(c);if(w){const T=w.getRect(h.value,f);S=_(T.top,l)}}else S=_(i,l);d.value=s[S],e&&n.forEach((w,T)=>{const{state:k,$el:it}=w;if(T===S||T===S-1){const $=it.getBoundingClientRect();k.left=$.left,k.width=$.width}else k.left=null,k.width=null;if(T===S)k.active=!0,k.top=Math.max(t.stickyOffsetTop,l[T].top-i)+f.top;else if(T===S-1&&c===""){const $=l[S].top-i;k.active=$>0,k.top=$+f.top-l[T].height}else k.active=!1}),c=""},z=()=>{_t(O)};Y("scroll",O,{target:h,passive:!0}),dt(z),j(()=>t.indexList,z),j(d,e=>{e&&g("change",e)});const st=()=>t.indexList.map(e=>{const s=e===d.value;return m("span",{class:B("index",{active:s}),style:s?p.value:void 0,"data-index":e},[e])}),M=e=>{c=String(e);const s=b(c);if(s){const i=P(h.value),f=E(h),{offsetHeight:l}=document.documentElement;if(s.$el.scrollIntoView(),i===l-f.height){O();return}t.sticky&&t.stickyOffsetTop&&mt(J()-t.stickyOffsetTop),g("select",s.index)}},G=e=>{const{index:s}=e.dataset;s&&M(s)},at=e=>{G(e.target)};let H;const ct=e=>{if(a.move(e),a.isVertical()){gt(e);const{clientX:s,clientY:i}=e.touches[0],f=document.elementFromPoint(s,i);if(f){const{index:l}=f.dataset;l&&H!==l&&(H=l,G(f))}}},X=()=>m("div",{ref:r,class:B("sidebar"),style:y.value,onClick:at,onTouchstartPassive:a.start},[st()]);return et({scrollTo:M}),Y("touchmove",ct,{target:r}),()=>{var e;return m("div",{ref:u,class:B()},[t.teleport?m(ht,{to:t.teleport},{default:()=>[X()]}):X(),(e=o.default)==null?void 0:e.call(o)])}}});const[Lt,Vt]=q("index-anchor"),Nt={index:U};var zt=F({name:Lt,props:Nt,setup(t,{slots:g}){const o=xt({top:0,left:null,rect:{top:0,height:0},width:null,active:!1}),u=I(),{parent:r}=yt(nt);if(!r)return;const d=()=>o.active&&r.props.sticky,a=D(()=>{const{zIndex:n,highlightColor:x}=r.props;if(d())return kt(Ct(n),{left:o.left?`${o.left}px`:void 0,width:o.width?`${o.width}px`:void 0,transform:o.top?`translate3d(0, ${o.top}px, 0)`:void 0,color:x})});return et({state:o,getRect:(n,x)=>{const c=E(u);return o.rect.height=c.height,n===window||n===document.body?o.rect.top=c.top+J():o.rect.top=c.top+P(n)-x.top,o.rect}}),()=>{const n=d();return m("div",{ref:u,style:{height:n?`${o.rect.height}px`:void 0}},[m("div",{style:a.value,class:[Vt({sticky:n}),{[St]:n}]},[g.default?g.default():t.index])])}}});const Mt=K(zt),Gt=K(Et);const Ht={class:"city-group"},Xt={class:"list"},Yt=["onClick"],jt={__name:"city-group",props:{groupData:{type:Object,default:()=>({})}},setup(t){const g=t,o=D(()=>{const a=g.groupData.cities.map(h=>h.group);return a.unshift("#"),a}),u=Z(),r=tt(),d=a=>{r.currentCity=a,u.back()};return(a,h)=>{const n=Mt,x=Rt,c=Gt;return v(),C("div",Ht,[m(c,{sticky:!1,"index-list":N(o)},{default:W(()=>[m(n,{index:"\u70ED\u95E8"}),L("div",Xt,[(v(!0),C(A,null,R(t.groupData.hotCities,(y,p)=>(v(),C("div",{class:"city",onClick:_=>d(y)},Tt(y.cityName),9,Yt))),256))]),(v(!0),C(A,null,R(t.groupData.cities,(y,p)=>(v(),C(A,{key:p},[m(n,{index:y.group},null,8,["index"]),(v(!0),C(A,null,R(y.cities,(_,b)=>(v(),V(x,{key:b,title:_.cityName,onClick:O=>d(_)},null,8,["title","onClick"]))),128))],64))),128))]),_:1},8,["index-list"])])}}},qt=Q(jt,[["__scopeId","data-v-0c698a78"]]);const Ft={class:"city top-page"},Ut={class:"top"},Jt={class:"content"},Kt={__name:"city",setup(t){const g=Z(),o=I(""),u=()=>{g.back()},r=I(),d=tt();d.fetchAllCitiesData();const{allCities:a}=bt(d);return D(()=>a.value[r.value]),(h,n)=>{const x=Dt,c=It,y=$t;return v(),C("div",Ft,[L("div",Ut,[m(x,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=p=>o.value=p),placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD",shape:"round","show-action":"",onCancel:u},null,8,["modelValue"]),m(y,{active:r.value,"onUpdate:active":n[1]||(n[1]=p=>r.value=p),color:"#ff9645"},{default:W(()=>[(v(!0),C(A,null,R(N(a),(p,_)=>(v(),V(c,{key:_,title:p.title,name:_},null,8,["title","name"]))),128))]),_:1},8,["active"])]),L("div",Jt,[(v(!0),C(A,null,R(N(a),(p,_,b)=>wt((v(),V(qt,{key:b,"group-data":p},null,8,["group-data"])),[[At,_===r.value]])),128))])])}}},ae=Q(Kt,[["__scopeId","data-v-e76070aa"]]);export{ae as default};
